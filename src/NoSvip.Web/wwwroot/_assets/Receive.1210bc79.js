let e=document.createElement("style");e.innerHTML="",document.head.appendChild(e);import{e as o,r as s,o as t,f as n,c as r,a as i,t as a,F as l,d as f}from"./index.5fcbb22c.js";import{P as c,e as d,s as h}from"./Peer.2bb12b4f.js";class u{constructor(e){this.file=e,this.reader=new FileReader,this.offset=0}getNextChunk(){return new Promise((e,o)=>{this.offset>=this.file.size&&e({done:!0}),this.reader.onload=o=>{const s=o.target.result;this.offset+=s.byteLength,e({done:this.offset>=this.file.size,chunk:s,offset:this.offset})},this.reader.onabort=()=>{o(new Error("FileReader abort"))},this.reader.onerror=e=>{o(new Error("FileReader onerror"+e))};const s=this.file.slice(this.offset,this.offset+65536);this.reader.readAsArrayBuffer(s)})}}var g={setup(){const e=n(),r=o(()=>e.params.rid),i=s(""),a=new c,l=e=>{a.connectPeer(e,!0)},f=e=>{i.value=e},g=e=>{a.signalingMessageCallback(e)};return t(()=>{d.on("onJoinedRoom",l),d.on("onSignalingMessage",g),a.on("onReceiveMessage",f)}),{roomId:r,sendMessage:()=>{a.sendJson()},joinRoom:e=>{h.invoke("JoinRoom",e).catch((function(e){return console.error(e.toString())}))},message:i,tirggerFile:async e=>{const o=new u(event.target.files[0]);console.log("开始传输文件..."),await a.sendJson({type:"TransferStart",fileId:0});let s=!1;for(;!s;){const e=await o.getNextChunk();s=e.done;const{chunk:t,offset:n}=e;try{await a.send(t)}catch(e){console.log("传输错误："+e);break}}console.log("传输文件完成..."),s&&await a.sendJson({type:"TransferEnd",fileId:0})}}}};g.render=function(e,o,s,t,n,c){return f(),r(l,null,[i("h1",null,"房间号: "+a(t.roomId)+" 接收端",1),i("button",{onClick:o[1]||(o[1]=e=>t.joinRoom(t.roomId))},"加入房间"),i("button",{onClick:o[2]||(o[2]=(...e)=>t.sendMessage(...e))},"发消息"),i("input",{type:"file",onChange:o[3]||(o[3]=e=>t.tirggerFile(e))},null,32)],64)},g.__file="src/views/Receive.vue";export default g;
